jQuery(function(a){a(".cf-file-upload").each(function(){a(this).fileupload({dataType:"json",dropZone:a(this),url:CFParams.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:CFParams.image_limit,formData:{script:!0},change:function(b,c){if(a("div.data_invalid").remove(),c.files.length>=CFParams.image_limit)return alert(CFParams.text_limit),!1},add:function(b,c){var d=a(this),e=d.closest("form"),f=d.parent().find(".cf-uploaded-files"),g=[],h=a(this).data("file_types");if(h){var i=new RegExp("(.|/)("+h+")$","i");c.originalFiles[0].name.length&&!i.test(c.originalFiles[0].name)&&g.push(CFParams.i18n_invalid_file_type+" "+h)}g.length>0?window.alert(g.join("\n")):(e.find(':input[type="submit"]').attr("disabled","disabled"),c.context=a('<progress value="" max="100"></progress>').appendTo(f),c.submit())},progress:function(a,b){var c=parseInt(b.loaded/b.total*100,10);b.context.val(c)},fail:function(b,c){var d=a(this),e=d.closest("form");c.errorThrown&&window.alert(c.errorThrown),c.context.remove(),e.find(':input[type="submit"]').removeAttr("disabled")},done:function(b,c){var d=a(this),e=d.closest("form"),f=d.parent().find(".cf-uploaded-files"),g=d.attr("multiple")?1:0,h=["jpg","gif","png","jpeg","jpe"];c.context.remove(),a.each(c.result.files,function(b,c){if(c.error)window.alert(c.error);else{var e;a.inArray(c.extension,h)>=0&&(e=a.parseHTML(CFParams.js_field_html_img),a(e).find(".cf-uploaded-file-preview img").attr("src",c.url)),a(e).find(".input-text").val(c.url),a(e).find(".input-text").attr("name","current_"+d.attr("name")),g?f.append(e):f.html(e)}}),e.find(':input[type="submit"]').removeAttr("disabled")}})}),a("#cf_gallery_images").on("click",function(b){a(".cf-uploaded-file-preview img").length>=CFParams.image_limit&&(alert(CFParams.text_limit),b.preventDefault())}),a("body").on("click",".cf-remove-uploaded-file",function(){return a(this).closest(".cf-uploaded-file").remove(),!1}),a("#send_car_form").click(function(b){b.preventDefault(),a("select,input").removeClass("required-field"),a("div.data_invalid").remove();var c=a("#car_brand").val();if(0==c)return a("#car_brand").addClass("required-field"),!1;var d=a("#car_model").val();if(0==a.trim(d))return a("#car_model").addClass("required-field"),!1;var e=a("#displacement").val();if(0==a.trim(e))return a("#displacement").addClass("required-field").focus(),!1;var f=a("#tank_type_size").val();if(0==a.trim(f))return a("#tank_type_size").addClass("required-field").focus(),!1;var g=a("#power").val();if(0==a.trim(g))return a("#power").addClass("required-field").focus(),!1;var h=a("#type_of_gas_system").val();if(0==a.trim(h))return a("#type_of_gas_system").addClass("required-field").focus(),!1;var i=/^[1-2][0-9]{3}$/,j=a("#year").val();if(0==a.trim(j))return a("#year").addClass("required-field").focus(),!1;if(!i.test(j))return a("#year").addClass("required-field").focus().after('<div class="data_invalid">'+CFParams.invalid_year+"</div>"),!1;var k=a("#range_in_gas_mode").val();if(0==a.trim(k))return a("#range_in_gas_mode").addClass("required-field").focus(),!1;var l=a("#mileage").val();if(0==a.trim(l))return a("#mileage").addClass("required-field").focus(),!1;var m=a("#car_month").val();if(0==a.trim(m))return a("#car_month").addClass("required-field"),!1;var n=a("#car_year").val();if(0==a.trim(n))return a("#car_year").addClass("required-field"),!1;if(!i.test(n))return a("#car_year").addClass("required-field").focus().after('<div class="data_invalid">'+CFParams.invalid_year+"</div>"),!1;if(0==a(".cf-uploaded-file").length)return a("#car_form_conteiner_for_upload_image").after('<div class="data_invalid" style="margin-left:15px;">'+CFParams.required_image+"</div>"),!1;var o=[];a(".cf-uploaded-file-preview img").each(function(){o.push(a(this).attr("src"))});var p={action:"cf_send_form",car_brand:c,car_name:a("#car_brand :selected").html(),displacement:e,power:g,year:j,mileage:l,car_model:d,tank_type_size:f,type_of_gas_system:h,range_in_gas_mode:k,car_month:m,car_year:n,description:a("#description").val(),imgs:o},q=a(this),r={txt:a(this).val(),bgColor:q.css("background-color"),color:q.css("color")};a.ajax({method:"POST",dataType:"json",url:CFParams.default_ajax_url,data:p,beforeSend:function(){q.attr("disabled","disabled").css({background:"#f5b3ab",color:"#901f11"}).val(CFParams.pending)},success:function(b){b.result?a("#car_form_primary").html('<div class="car_notice success">'+b.html+"</div>"):a("#car_form_primary").prepend('<div class="car_notice error">'+b.html+"</div>"),q.removeAttr("disabled").css({background:r.bgColor,color:r.color}).val(r.txt)}})})});